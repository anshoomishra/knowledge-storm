{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-8 scrollable-content shadow-sm px-5">
            <!-- Article Details Section -->
            {% if messages %}
            <div class="mt-3">
                {% for message in messages %}
                {% if message.tags == 'error' %}
                <div class="alert alert-danger">{{ message }}</div>
                {% else %}
                <div class="alert alert-{{message.tags}}">{{ message }}</div>
                {% endif %}
                {% endfor %}
            </div>
            {% endif %}
            <div class="row">
                <div class="col-md-12">
                    <div class="blog-heading d-flex mb-2">
                        <div class="logo d-flex justify-content-center align-items-center text-white">
                            KS
                        </div>
                        <div class="heading-description px-4">
                            <div class="heading">
                                <h4 class="mb-1">{{ article.title }}</h4>
                            </div>
                            <div class="description">
                                <p class="mb-1">{{ article.description }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="blog-category mb-3 mt-4">
                        <span>Categories â†’ </span>
                        {% for tag in article.keywords.all %}
                        <span class="text-info "> {{tag.text}} </span>
                        {% endfor %}
                    </div>
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <div class="d-flex mb-4 mt-4">
                                <span>Last Updated: {{ article.updated_at }}</span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            {% if user.is_authenticated %}
                            <a href="{% url 'save_article' article.id %}" class="btn btn-light text-dark border">Save article</a>
                            {% else %}
                            <a href="{% url 'login' %}?next={% url 'article_detail' article.id %}" class="btn btn-primary">Login to save article</a>
                            {% endif %}
                             <div class="mt-4">
                <h5>Share this article:</h5>
                <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri|urlencode }}" target="_blank" class="btn btn-primary">
                    fb
                </a>
                <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri|urlencode }}&text={{ article.title|urlencode }}" target="_blank" class="btn btn-info">
                    tw
                </a>
                <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri|urlencode }}&title={{ article.title|urlencode }}&summary={{ article.description|urlencode }}" target="_blank" class="btn btn-secondary">
                    lkn
                </a>
            </div>
                        </div>
                    </div>

                    <hr>
                </div>
            </div>
            <div>{{ article.content|safe }}</div>

            <!-- Comments Section -->
            <div class="mt-5">
                <h5>Comments</h5>
                {% for comment in comments %}
                    {% include 'blog/comment.html' with comment=comment article=article %}
                {% endfor %}
            </div>

            <!-- Comment Form -->
            <div class="mt-5 mb-5">
                <h5>Leave a Comment</h5>
                <form method="post">
                    {% csrf_token %}
                    {{ form.as_p }}
                     <input type="hidden" name="next" value="{{ request.GET.next }}">
                    <button type="submit" class="btn btn-primary rounded-0">Submit</button>
                </form>
            </div>
        </div>

        <!-- User Details Section -->
        <div class="col-md-4">
            <div class="sticky-top">
                <h3>Author Details</h3>
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">{{ article.created_by.username }}</h5>
                        <p class="card-text"><strong>Email:</strong> {{ article.created_by.email }}</p>
                        <p class="card-text"><strong>Member since:</strong> {{ article.created_by.date_joined }}</p>
                        <a href="{% url 'user_profile' %}">Profile</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Related Articles Section -->
    <div class="related articles mt-5">
        <h3>Related Articles</h3>
        <ul>
            {% for related_article in related_articles %}
            <li>
                <a href="{% url 'article_detail' related_article.id %}">
                    {{ related_article.title }}
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}
